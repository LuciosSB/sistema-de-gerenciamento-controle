<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Detalhes da Solicita√ß√£o</title>
</head>
<body>
    <!-- Cabe√ßalho do Sistema -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Sistema de Solicita√ß√µes</div>
                <div class="user-info">
                    <div class="user-icon">üë§</div>
                    <span class="user-name">Administrador</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navega√ß√£o -->
    <nav>
        <div class="container">
            <ul class="nav-list">
                <li><a href="{{ url_for('exibir_index') }}">P√°gina Inicial</a></li>
                <li class="active"><a href="{{ url_for('gerenciar_solicitacoes') }}">Gerenciar Solicita√ß√µes</a></li>
                <li><a href="{{ url_for('cadastro_produto') }}">Cadastro</a></li>
                <li><a href="{{ url_for('listar_produtos') }}">Listar Produtos</a></li>
                <li><a href="{{ url_for('selecionar_produto_atualizar') }}">Atualizar Produtos</a></li>
                <li><a href="{{ url_for('saida_produto') }}">Sa√≠da de Produtos</a></li>
            </ul>
        </div>
    </nav>

    <!-- Conte√∫do Principal -->
    <div class="container">
        <div class="main-content">
            <div class="panel active" id="detalhes-panel">
                <div class="panel-header">
                    <h2>Detalhes da Solicita√ß√£o #{{ solicitacao.id }}</h2>
                    <div class="header-actions">
                        <div class="status-badge 
                            {% if solicitacao.status == 'pendente' %}status-pendente
                            {% elif solicitacao.status == 'aprovada' %}status-aprovada
                            {% elif solicitacao.status == 'rejeitada' %}status-rejeitada
                            {% elif solicitacao.status == 'entregue' %}status-entregue
                            {% endif %}">
                            {% if solicitacao.status == 'pendente' %}
                                üîÑ Pendente
                            {% elif solicitacao.status == 'aprovada' %}
                                ‚úÖ Aprovada
                            {% elif solicitacao.status == 'rejeitada' %}
                                ‚ùå Rejeitada
                            {% elif solicitacao.status == 'entregue' %}
                                üì¶ Entregue
                            {% else %}
                                {{ solicitacao.status }}
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="panel-content">
                    <!-- Informa√ß√µes da Solicita√ß√£o -->
                    <div class="detalhes-container">
                        <!-- Se√ß√£o: Dados do Solicitante -->
                        <div class="detalhes-section">
                            <h3 class="section-title">
                                <span class="section-icon">üë§</span>
                                Dados do Solicitante
                            </h3>
                            <div class="detalhes-grid">
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Nome do Solicitante:</label>
                                    <span class="detalhe-valor">{{ solicitacao.nome_solicitante }}</span>
                                </div>
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Setor:</label>
                                    <span class="detalhe-valor">{{ solicitacao.setor }}</span>
                                </div>
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Data/Hora da Solicita√ß√£o:</label>
                                    <span class="detalhe-valor">{{ solicitacao.data_solicitacao.strftime('%d/%m/%Y √†s %H:%M') }}</span>
                                </div>
                                <div class="detalhe-item">
                                    <label class="detalhe-label">N√∫mero da Solicita√ß√£o:</label>
                                    <span class="detalhe-valor">#{{ solicitacao.id }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Se√ß√£o: Dados do Item/Equipamento -->
                        <div class="detalhes-section">
                            <h3 class="section-title">
                                <span class="section-icon">üì¶</span>
                                Dados do Item/Equipamento
                            </h3>
                            <div class="detalhes-grid">
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Nome do Item/Equipamento:</label>
                                    <span class="detalhe-valor">{{ solicitacao.nome_item }}</span>
                                </div>
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Quantidade Solicitada:</label>
                                    <span class="detalhe-valor">{{ solicitacao.quantidade }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Se√ß√£o: Descri√ß√£o -->
                        <div class="detalhes-section">
                            <h3 class="section-title">
                                <span class="section-icon">üìù</span>
                                Descri√ß√£o e Informa√ß√µes Adicionais
                            </h3>
                            <div class="descricao-container">
                                {% if solicitacao.descricao %}
                                    <p class="descricao-texto">{{ solicitacao.descricao }}</p>
                                {% else %}
                                    <p class="descricao-vazia">Nenhuma descri√ß√£o adicional foi fornecida.</p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Se√ß√£o: Hist√≥rico de Atualiza√ß√µes -->
                        {% if solicitacao.data_atualizacao %}
                        <div class="detalhes-section">
                            <h3 class="section-title">
                                <span class="section-icon">üïí</span>
                                Hist√≥rico
                            </h3>
                            <div class="detalhes-grid">
                                <div class="detalhe-item">
                                    <label class="detalhe-label">√öltima Atualiza√ß√£o:</label>
                                    <span class="detalhe-valor">{{ solicitacao.data_atualizacao.strftime('%d/%m/%Y √†s %H:%M') }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- A√ß√µes da Solicita√ß√£o -->
                    <div class="acoes-container">
                        <h3 class="section-title">
                            <span class="section-icon">‚öôÔ∏è</span>
                            A√ß√µes da Solicita√ß√£o
                        </h3>
                        
                        {% if solicitacao.status == 'pendente' %}
                        <div class="acoes-buttons">
                            <form method="POST" action="{{ url_for('atualizar_status_solicitacao', solicitacao_id=solicitacao.id) }}" 
                                  style="display: inline;" onsubmit="return confirm('Confirma que deseja APROVAR esta solicita√ß√£o?')">
                                <input type="hidden" name="status" value="aprovada">
                                <button type="submit" class="btn btn-atender">
                                    <span class="btn-icon">‚úÖ</span>
                                    Aprovar Solicita√ß√£o
                                </button>
                            </form>
                            
                            <form method="POST" action="{{ url_for('atualizar_status_solicitacao', solicitacao_id=solicitacao.id) }}" 
                                  style="display: inline;" onsubmit="return confirm('Confirma que deseja REJEITAR esta solicita√ß√£o? Esta a√ß√£o pode ser revertida.')">
                                <input type="hidden" name="status" value="rejeitada">
                                <button type="submit" class="btn btn-rejeitar">
                                    <span class="btn-icon">‚ùå</span>
                                    Rejeitar Solicita√ß√£o
                                </button>
                            </form>
                        </div>

                        {% elif solicitacao.status == 'aprovada' %}
                        <div class="acoes-buttons">
                            <form method="POST" action="{{ url_for('atualizar_status_solicitacao', solicitacao_id=solicitacao.id) }}" 
                                  style="display: inline;" onsubmit="return confirm('Confirma que esta solicita√ß√£o foi ENTREGUE?')">
                                <input type="hidden" name="status" value="entregue">
                                <button type="submit" class="btn btn-entregar">
                                    <span class="btn-icon">üì¶</span>
                                    Marcar como Entregue
                                </button>
                            </form>
                            
                            <form method="POST" action="{{ url_for('atualizar_status_solicitacao', solicitacao_id=solicitacao.id) }}" 
                                  style="display: inline;" onsubmit="return confirm('Deseja voltar esta solicita√ß√£o para PENDENTE?')">
                                <input type="hidden" name="status" value="pendente">
                                <button type="submit" class="btn btn-secondary">
                                    <span class="btn-icon">üîÑ</span>
                                    Voltar para Pendente
                                </button>
                            </form>
                        </div>

                        {% elif solicitacao.status == 'rejeitada' %}
                        <div class="acoes-buttons">
                            <form method="POST" action="{{ url_for('atualizar_status_solicitacao', solicitacao_id=solicitacao.id) }}" 
                                  style="display: inline;" onsubmit="return confirm('Deseja voltar esta solicita√ß√£o para PENDENTE?')">
                                <input type="hidden" name="status" value="pendente">
                                <button type="submit" class="btn btn-secondary">
                                    <span class="btn-icon">üîÑ</span>
                                    Voltar para Pendente
                                </button>
                            </form>
                        </div>

                        {% elif solicitacao.status == 'entregue' %}
                        <div class="acoes-info">
                            <div class="info-box info-entregue">
                                <span class="info-icon">‚úÖ</span>
                                <span class="info-text">Esta solicita√ß√£o foi entregue</span>
                            </div>
                            <form method="POST" action="{{ url_for('atualizar_status_solicitacao', solicitacao_id=solicitacao.id) }}" 
                                  style="display: inline; margin-top: 10px;" onsubmit="return confirm('Deseja voltar esta solicita√ß√£o para APROVADA?')">
                                <input type="hidden" name="status" value="aprovada">
                                <button type="submit" class="btn btn-secondary btn-small">
                                    <span class="btn-icon">‚Ü©Ô∏è</span>
                                    Reverter para Aprovada
                                </button>
                            </form>
                        </div>
                        {% endif %}

                        <!-- A√ß√£o de Exclus√£o (sempre dispon√≠vel para admin) -->
                        <div class="acoes-danger" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                            <form method="POST" action="{{ url_for('excluir_solicitacao', solicitacao_id=solicitacao.id) }}" 
                                  style="display: inline;" onsubmit="return confirm('ATEN√á√ÉO: Deseja EXCLUIR permanentemente esta solicita√ß√£o? Esta a√ß√£o N√ÉO pode ser desfeita!')">
                                <button type="submit" class="btn btn-danger">
                                    <span class="btn-icon">üóëÔ∏è</span>
                                    Excluir Solicita√ß√£o
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- A√ß√µes de Navega√ß√£o -->
                    <div class="page-actions">
                        <a href="{{ url_for('gerenciar_solicitacoes') }}" class="btn btn-secondary">
                            ‚¨ÖÔ∏è Voltar para Lista
                        </a>
                        <a href="{{ url_for('exibir_index') }}" class="btn btn-secondary">
                            üè† P√°gina Inicial
                        </a>
                        <button onclick="location.reload()" class="btn btn-primary">
                            üîÑ Atualizar P√°gina
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Anima√ß√µes de entrada
        window.addEventListener('load', function() {
            const sections = document.querySelectorAll('.detalhes-section, .acoes-container');
            sections.forEach((section, index) => {
                setTimeout(() => {
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, index * 150);
            });
        });

        // Confirma√ß√µes adicionais para a√ß√µes cr√≠ticas
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(e) {
                const button = this.querySelector('button[type="submit"]');
                if (button && !button.classList.contains('btn-danger')) {
                    button.disabled = true;
                    
                    // Salvar texto original
                    const originalText = button.innerHTML;
                    button.innerHTML = '<span class="btn-icon">‚è≥</span> Processando...';
                    
                    // Reabilitar o bot√£o ap√≥s 3 segundos em caso de erro
                    setTimeout(() => {
                        button.disabled = false;
                        button.innerHTML = originalText;
                    }, 3000);
                }
            });
        });

        // Auto-hide flash messages ap√≥s 5 segundos
        setTimeout(function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(function(message) {
                message.style.opacity = '0';
                message.style.transform = 'translateY(-20px)';
                setTimeout(() => message.remove(), 300);
            });
        }, 5000);
    </script>
</body>
</html>