<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Detalhes do Chamado #{{ solicitacao.id }}</title>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Sistema de Manuten√ß√£o</div>
                <div class="user-info">
                    <div class="user-icon">üë§</div>
                    <span class="user-name">Administrador</span>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul class="nav-list">
                <li><a href="{{ url_for('dashboard') }}">P√°gina Inicial</a></li>
                <li class="active"><a href="{{ url_for('gerenciar_solicitacoes') }}">Gerenciar Chamados</a></li>
                <li><a href="{{ url_for('cadastro_produto') }}">Cadastro de Itens</a></li>
                <li><a href="{{ url_for('listar_produtos') }}">Listar Itens</a></li>
                <li><a href="{{ url_for('selecionar_produto_atualizar') }}">Atualizar Itens</a></li>
                </ul>
        </div>
    </nav>

    <div class="container">
        <div class="main-content">
            <div class="panel active" id="detalhes-panel">
                <div class="panel-header">
                    <h2>Detalhes do Chamado #{{ solicitacao.id }}</h2>
                    <div class="header-actions">
                        <div class="status-badge 
                            {% if solicitacao.status == 'pendente' %}status-pendente
                            {% elif solicitacao.status == 'aprovada' %}status-aprovada
                            {% elif solicitacao.status == 'rejeitada' %}status-rejeitada
                            {% elif solicitacao.status == 'entregue' %}status-entregue
                            {% endif %}">
                            {{ solicitacao.status|capitalize }}
                        </div>
                    </div>
                </div>

                <div class="panel-content">
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                            <div class="flash-message {{ category }}">
                                <div class="flash-text">{{ message }}</div>
                            </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <div class="detalhes-container">
                        <div class="detalhes-section">
                            <h3 class="section-title">
                                <span class="section-icon">üìã</span>
                                Detalhes do Chamado
                            </h3>
                            <div class="detalhes-grid">
                                <div class="detalhe-item detalhe-full">
                                    <label class="detalhe-label">T√≠tulo:</label>
                                    <span class="detalhe-valor titulo-principal">{{ solicitacao.titulo }}</span>
                                </div>
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Categoria:</label>
                                    <span class="detalhe-valor">{{ solicitacao.categoria }}</span>
                                </div>
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Urg√™ncia:</label>
                                    <div class="urgencia-badge urgencia-{{ solicitacao.urgencia|lower }}">
                                        {{ solicitacao.urgencia|capitalize }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="detalhes-section">
                            <h3 class="section-title">
                                <span class="section-icon">üë§</span>
                                Dados do Solicitante
                            </h3>
                            <div class="detalhes-grid">
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Nome:</label>
                                    <span class="detalhe-valor">{{ solicitacao.nome_solicitante }}</span>
                                </div>
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Setor:</label>
                                    <span class="detalhe-valor">{{ solicitacao.setor }}</span>
                                </div>
                                <div class="detalhe-item">
                                    <label class="detalhe-label">Data/Hora da Abertura:</label>
                                    <span class="detalhe-valor">{{ solicitacao.data_solicitacao.strftime('%d/%m/%Y √†s %H:%M') }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="detalhes-section">
                            <h3 class="section-title">
                                <span class="section-icon">üìù</span>
                                Descri√ß√£o do Problema
                            </h3>
                            <div class="descricao-container">
                                {% if solicitacao.descricao %}
                                    <p class="descricao-texto">{{ solicitacao.descricao }}</p>
                                {% else %}
                                    <p class="descricao-vazia">Nenhuma descri√ß√£o detalhada foi fornecida.</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="detalhes-section">
                        <h3 class="section-title">
                            <span class="section-icon">üì¶</span>
                            Itens Utilizados no Chamado
                        </h3>
                        <div class="table-container">
                            {% if solicitacao.materiais_usados %}
                            <table class="solicitacoes-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Quantidade Retirada</th>
                                        <th>Data da Retirada</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for saida in solicitacao.materiais_usados %}
                                    <tr>
                                        <td>{{ saida.produto.nome }}</td>
                                        <td>{{ saida.quantidade_saida }}</td>
                                        <td>{{ saida.data_saida.strftime('%d/%m/%Y %H:%M') }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                            <p class="empty-list-message">Nenhum material foi retirado para este chamado ainda.</p>
                            {% endif %}
                        </div>
                    </div>

                    {% if solicitacao.status == 'aprovada' %}
                    <div class="detalhes-section add-item-form-section">
                        <h3 class="section-title">
                            <span class="section-icon">‚ûï</span>
                            Adicionar Item/Material
                        </h3>
                        <form method="POST" action="{{ url_for('adicionar_item_solicitacao', solicitacao_id=solicitacao.id) }}">
                            <div class="form-row">
                                <div class="form-group" style="flex-grow: 2;">
                                    <label for="produto_id">Produto:</label>
                                    <select name="produto_id" class="setor-select" required>
                                        <option value="">Selecione um produto...</option>
                                        {% for produto in produtos_disponiveis %}
                                            <option value="{{ produto.id }}">
                                                {{ produto.nome }} (Estoque: {{ produto.quantidade }})
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="quantidade_saida">Quantidade:</label>
                                    <input type="number" name="quantidade_saida" class="cadastro-input" min="1" required>
                                </div>
                            </div>
                            <div class="form-actions" style="justify-content: flex-end; border-top: none; padding-top: 0;">
                                <button type="submit" class="btn btn-primary">Adicionar ao Chamado</button>
                            </div>
                        </form>
                    </div>
                    {% endif %}
                    
                    <div class="acoes-container">
                        </div>

                    <div class="page-actions">
                        <a href="{{ url_for('gerenciar_solicitacoes') }}" class="btn btn-secondary">‚¨ÖÔ∏è Voltar para Lista</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function toggleRejeitarForm() {
            var formContainer = document.getElementById('rejeitarFormContainer');
            if (formContainer.style.display === 'none') {
                formContainer.style.display = 'block';
            } else {
                formContainer.style.display = 'none';
            }
        }
    </script>
</body>
</html>